sudo: required

services:
  - docker                  

before_install:            
  - mkdir -p output
  - docker pull asciidoctor/docker-asciidoctor

# Name the file explicitly until we sort out the organization of the
# 'documentation' project. Removed the Hyrax Guide since it is nowin
# its own project. jhrg 1/11/17

env:
  global:
    # GIT_UID
    - secure: "d52SVZ4KE50cZq3p0Hv9OLDEtTacCtosbrPf3CS/zi9BG+mItYrdQSQxJUSbcfbkvdaSZtiJwGRYXVQy7MIT9cuiHU9q7aA8K5UuSkNvLwjbAkxxKSsOJa2KHtpP65TK2IjCj4ZmTLz0bouaeF/UgXt4r07iGI8MjYjESuSwrekUa4KjteLT14WX7CHB7V3gSkPW+OGfskDYqBJPxv0Z4Gi+6BhnWgaqCOW0ClQ/41jYuJoMp1M7HMiptSgd/CxoKDcJjia+sScJ9yjdnxsrLQRzOp3LuXMV6ur1kuwTB9rFJ+6B251Rg15h7TPoXWZl5SZOcpCYCQqmMkjYTevFlnkySzs6d6CYKowdWtJHEe7G8s3/v8VziaMnfZzS7TuBG85ziBG1gtl45QLSxdQnlgjHjkYpezG7mpWrhbBge15/9qF5zBeM1jaNuu9CTafAbOv4TWfiVIC7FH/L/5lSErJnEWF1lIT5V/rxgVFCid4JZ9lkgndJjXV3AqZowvpbrjS5T0O1GaDvy/YyT1WeU5JmHXKQ570i8fvlU9dkZ1hX7HYvKkEuarC4T0xg0i9KWyv7X0TwYQmVt0YzrT9kGdq9vJ7GzFr9rScvcbNV6SJQW1SMM27qnMIelBecULEk9G+LR61BzFEH/qPF3mP4bqDZ5UpsNXd0y/BKSrn1DQI="
    # GIT_TOKEN
    - secure: "YEh8BC0DWRRIw7pojcEExoyVRBTvCmtcztpoTNN3pkxEnshtt6x7mkGkDZvHL00fA4Oz2i/3KBr6sYU5zKds/aPz6dhZYwffSOMyI3FCvhJ/IfNemDuC++g2e/La8czaHQot9pWyqUzcMEmFlwe33VYE4JZhFd5LIpqqolVKS0Fdtf+EpvVbW/CBAXP4s6JCAwtaj53cSgh4O5vdgatkDX8SFmROtljXqx9vxnnlhBqvbt8bfRS56PsaxdyPlqAeuJ1ub2qPBUg6K9oa6Q1kW0STt8p+uMFbKejN0mHHkOIqyU2rtqy2t4H4D3bBE1lVEWhOiEmdAaPYwoHDUyR8suU5+dvo7JcLZB2cO+sVKIPo5LViQ1XRCx+282ZPTwVLJqdGXsQBAPGWx88Mk6dH84ST3oIslM1RxUYspO9Th6wYFFjrJ4PReJcKDwhoHrP/ATcy26PPbPgaTnmdEgnyQYeQ+fc2+jwmlH0rzhrPf470cHklvIbzyH1IMzvjb/KOCKmcWBuOGwTE/Fl6PK+Y3vVUngW3PGXPfBDSq0k9i8ey6JM8LxYzDF895PAan1CRaPaQTQlUzHEyFTBw7cGnxMggSqMhKQVbKp98LxMXE9CHwVFt+82IS4Hnx8Tps5iDmYwFmvivqbfi562HhX/Eq+rvOvX08Vvj0klRhEsDuuY="

script:
  - docker run -v $TRAVIS_BUILD_DIR:/documents/ --name asciidoc-to-html asciidoctor/docker-asciidoctor asciidoctor -D /documents/output README.adoc UserGuideComprehensive.adoc QuickStart.adoc tutorials/*.adoc
  - docker run -v $TRAVIS_BUILD_DIR:/documents/ --name asciidoc-to-pdf asciidoctor/docker-asciidoctor asciidoctor-pdf -D /documents/output README.adoc UserGuideComprehensive.adoc QuickStart.adoc tutorials/*.adoc

after_error: 
  - docker logs asciidoc-to-html
  - docker logs asciidoc-to-pdf

after_failure:
  - docker logs asciidoc-to-html
  - docker logs asciidoc-to-pdf

# The README.adoc here include the links needed for the Hyrax_Guide that is in the
# hyrax_guide repo. jhrg 10/11/17

after_success:      
  - cd output ; mv README.html index.html ; ls -l ; cp -R ../images images
  - git init
  - git config --global user.name "The-Robot-Travis"
  - git config --global user.email "npotter@opendap.org"
  - git add . ; git commit -m "Deploy to GitHub Pages"
  - git branch
  - git push --force --verbose "https://${GIT_UID}:${GIT_TOKEN}@github.com/OPENDAP/documentation" master:gh-pages
  - git status
  # - git push "https://${GIT_UID}:${GIT_PSWD}@github.com/OPENDAP/bes" --all;
